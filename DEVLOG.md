# MojaHrvatska — Development Log

**Domain:** mojahrvatska.com.hr
**Stack:** Astro 5.x, Tailwind CSS v4, Cloudflare Pages
**Data:** DZS Census 2021 (static data, no cron)
**Pages:** 583 (128 cities + 428 municipalities + 21 counties + index + rang-lista + usporedba + 404 + impressum + privatnost)

---

## 2026-02-16 — v1 Launch

### Site scaffold & architecture
- Scaffolded from `daily-data` template via `slop-init.sh`
- Configured `site.config.json`: siteName "MojaHrvatska", theme blue (#1e3a5f), no cron
- Data layer: `src/data/*.ts` — counties.ts (21), cities.ts (128), municipalities.ts (428)
- Search index generated by `scripts/generate-search-index.mjs` → `public/search-index.json` (577 entries)
- Compare data: `public/locations-compare.json` (556 entries for comparison tool)

### Theme & components
- Dark blue theme (`gray-950` bg, `blue-600` accent) in `global.css` with Tailwind v4 `@theme` blocks
- Components: Header, NavTabs, Footer, SearchBar (Fuse.js), LocationCard, StatCard, Breadcrumb, LocationMeta, WikiDescription, SortableTable, CompareTool, SurnameList, CroatiaMap, SEOHead, Analytics, ConsentBanner
- Interactive SVG county map (CroatiaMap.astro): color-coded by population change, hover tooltips, click→county page

### Pages
- Homepage: stats overview (3.87M pop, 21 counties, 556 cities/municipalities), SVG map, search bar, county list, "Zanimljivosti" facts, top 10 cities
- Location detail pages: `/grad/[slug]/`, `/opcina/[slug]/`, `/zupanija/[slug]/` — breadcrumb, population stats (2021 vs 2011), Wikipedia description, surname list, sub-location tables
- Rang-lista: sortable tables for cities and municipalities
- Usporedba: side-by-side location comparison tool
- Duplicate slug handling: append county suffix (e.g. "privlaka-zadar", "privlaka-vukovar")
- Schema.org JSON-LD: `WebSite` on index, `Article` on detail pages

### Build & deploy
- 583 pages built in ~1.7s
- Deployed to Cloudflare Pages via GitHub Actions (`build-deploy.yml`)
- No daily cron needed (static census data)
- Google Analytics: G-PJLZXZ7YMQ

### Wikipedia enrichment
- Wikidata/Wikipedia integration: 571/577 locations have descriptions (99.6% coverage)
- Custom title mapping handles mismatches between DZS names and Wikipedia article titles

---

## 2026-02-23 — A++ Polish

Six fixes to bring the site from grade A to A++:

### Fix 1: WCAG AA contrast
- Replaced `text-gray-500` and `text-gray-600` with `text-gray-400` across 20 .astro files
- `text-gray-500` (#64748b) on dark bg = ~3.8:1 (fails WCAG AA 4.5:1)
- `text-gray-400` (#94a3b8) on dark bg = ~6.7:1 (passes comfortably)
- Files: NavTabs, Footer, Header, SearchBar, LocationCard, Breadcrumb, StatCard, SortableTable, LocationMeta, WikiDescription, CompareTool, SurnameList, 404, impressum, privatnost, usporedba, index, grad/[slug], opcina/[slug], zupanija/[slug]

### Fix 2: Sitemap lastmod
- Added `serialize` callback to `sitemap()` in `astro.config.mjs`
- Sets `<lastmod>` to current build date (ISO string) for Google freshness signals

### Fix 3: robots.txt
- Added `Disallow: /search-index.json` to prevent crawlers indexing raw JSON

### Fix 4: Mobile hamburger menu
- Added hamburger toggle button to NavTabs (visible on mobile, hidden on sm+)
- Tabs stack vertically when menu is open on mobile
- Horizontal scroll preserved on desktop (sm+)
- JS toggle: aria-expanded, icon swap (hamburger ↔ X)

### Fix 5: GA4 in site.config.json
- Added `"gaId": "G-PJLZXZ7YMQ"` to `site.config.json`
- Updated `src/layouts/Layout.astro` to read GA ID from config with conditional rendering
- Uses `define:vars` to pass gaId into inline script

### Fix 6: Monetization cleanup
- Set `"monetization": "none"` (was "ads" with empty adsenseId)
- Consent banner no longer renders (not needed without ads)
- When AdSense is approved, switch back to "ads" and add the ID

### Build verification
- 583 pages built clean in 1.69s
- GA4 tag confirmed in dist/index.html
- `<lastmod>` confirmed in dist/sitemap-0.xml
- robots.txt confirmed with Disallow rule
- Mobile nav tested at 375px viewport: hamburger works, tabs stack vertically
- No consent banner in output
- 24 files changed, 2 commits pushed, both deploys succeeded
